# Makefile Sistema Aquário - Integrado (Linux/Windows)
CXX = g++
CXXFLAGS = -std=c++14 -Wall -Wextra

# Detectar sistema operacional
UNAME_S := $(shell uname -s)
ifeq ($(UNAME_S),Linux)
    LDFLAGS = -lncurses
    TARGET = aquario
else ifeq ($(UNAME_S),Darwin)
    LDFLAGS = -lncurses
    TARGET = aquario
else
    LDFLAGS = -L./Libs -l:pdcurses.a
    TARGET = aquario.exe
endif

# Arquivos fonte
SOURCES_NOTICIA = Data.cpp Avisos.cpp fofoca.cpp Humor.cpp StackOverflow.cpp Anonimo.cpp
SOURCES_CONTROLE = Controle.cpp
SOURCES_ALL = $(SOURCES_NOTICIA) $(SOURCES_CONTROLE)

# Objetos
OBJECTS_NOTICIA = $(SOURCES_NOTICIA:.cpp=.o)
OBJECTS_CONTROLE = $(SOURCES_CONTROLE:.cpp=.o)
OBJECTS_ALL = $(SOURCES_ALL:.cpp=.o)

# Regra principal - compila todo o sistema
all: $(TARGET)

# Cria o executável principal
$(TARGET): $(OBJECTS_ALL) main.o
	$(CXX) $(CXXFLAGS) -o $@ $^ $(LDFLAGS)
	@echo "✅ Sistema Aquário compilado com sucesso!"

# Compila apenas as classes de notícia (compatibilidade)
noticias: $(OBJECTS_NOTICIA)
	@echo "✅ Classes de notícia compiladas!"

# Compila apenas o controle
controle: $(OBJECTS_CONTROLE)
	@echo "✅ Classe Controle compilada!"

# Regra para objetos individuais
%.o: %.cpp
	$(CXX) $(CXXFLAGS) -c $< -o $@

# Cria um main.cpp básico se não existir
main.cpp:
	@echo "Criando main.cpp com interface ncurses..."
	@echo '#include "Controle.hpp"' > main.cpp
	@echo '#include <iostream>' >> main.cpp
	@echo 'using namespace std;' >> main.cpp
	@echo '' >> main.cpp
	@echo 'int main() {' >> main.cpp
	@echo '    try {' >> main.cpp
	@echo '        Controle sistema;' >> main.cpp
	@echo '        sistema.executarEditor();' >> main.cpp
	@echo '        return 0;' >> main.cpp
	@echo '    } catch (const exception& e) {' >> main.cpp
	@echo '        cerr << "Erro: " << e.what() << endl;' >> main.cpp
	@echo '        return 1;' >> main.cpp
	@echo '    }' >> main.cpp
	@echo '}' >> main.cpp
	@echo "✅ main.cpp criado!"

# Teste de compilação
test: $(OBJECTS_ALL)
	@echo "✅ Teste de compilação bem-sucedido!"
	@echo "Objetos gerados: $(OBJECTS_ALL)"

# Executa o programa
run: $(TARGET)
	./$(TARGET)

# Limpeza
clean:
	rm -f $(OBJECTS_ALL) main.o $(TARGET) aquario.exe

distclean: clean
	rm -f main.cpp
	@echo "Limpeza completa realizada!"

# Ajuda
help:
	@echo "Sistema Aquário - Comandos disponíveis:"
	@echo "  make          - Compila todo o sistema integrado"
	@echo "  make noticias - Compila apenas classes de notícia"
	@echo "  make controle - Compila apenas classe Controle"
	@echo "  make test     - Testa compilação"
	@echo "  make run      - Compila e executa o programa"
	@echo "  make clean    - Remove arquivos objeto e executável"
	@echo "  make distclean- Limpeza completa incluindo main.cpp"
	@echo "  make help     - Mostra esta ajuda"
	@echo ""
	@echo "Sistema detectado: $(UNAME_S)"
	@echo "Bibliotecas: $(LDFLAGS)"

.PHONY: all noticias controle test run clean distclean help
